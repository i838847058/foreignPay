import{E as e,h as a,i as l,y as t,A as u,F as r,G as d,H as o,I as s,j as n,J as i,k as p,d as _,B as m,b as c,K as v,L as f,C as g,e as h,D as b}from"./element-plus-1f849017.js";import{b as y,e as V,_ as w,d as k}from"./index-af938672.js";import{_ as x}from"./index-3d8d34dc.js";import{s as C,c as j,g as z,u as U,a as q}from"./index-0508f53c.js";import{d as D,e as E,f as T,J as F,o as I,c as M,O as A,R as B,a as L,S as O,V as P,P as R,a8 as S,X as $,u as G,A as H,at as J,au as K,i as W,z as X,W as N,ag as Q}from"./@vue-af2a374f.js";import{A as Y}from"./index-d4b26e89.js";import"./lodash-es-968ab13b.js";import"./async-validator-cf877c1f.js";import"./@vueuse-be664744.js";import"./dayjs-3df08a9b.js";import"./clipboard-690b0fc8.js";import"./@element-plus-ce49c33a.js";import"./@ctrl-91de2ec7.js";import"./@popperjs-b78c3215.js";import"./escape-html-3c2115ff.js";import"./normalize-wheel-es-3222b0a2.js";import"./vue-router-0700730f.js";import"./axios-fb7d3bb8.js";import"./pinia-a9355e46.js";import"./pinia-plugin-persistedstate-d2bd58cf.js";import"./zipson-d6101bf1.js";import"./mitt-f0e54764.js";const Z=e=>(J("data-v-450085ae"),e=e(),K(),e),ee={key:0},ae=Z((()=>L("div",{class:"form-text-item"},"支付产品：代收",-1))),le=Z((()=>L("div",{class:"form-text-item"},"支付产品：代付",-1))),te=Z((()=>L("span",{class:"text-required",style:{"font-size":"12px"}},"循环保证金：",-1))),ue=Z((()=>L("div",{class:"form-text-item"}," 注：商户可提现金额=商户余额*（1-循环保证金比例） ",-1))),re=Z((()=>L("div",{class:"revolving-margin"}," #未开启循环保证金则不展示保证金比例 ",-1))),de={class:"dialog-footer"},oe=w(D({__name:"MerchantEntryDialog",props:["merchantData"],setup(m,{expose:c}){const v=m,f=H("emitter"),g=E([]),h=y(),b=["商户基本信息","支付产品信息"],w=E(0),k=E(!1),z=E(0),U=E(!1),q=E(),D=E();T(k,((e,a)=>{e&&(Q.value=J(),C({text:"",role:1}).then((e=>{q.value=e.data||[]})),C({text:"",role:2}).then((e=>{D.value=e.data||[]})),v.merchantData&&(X(v.merchantData.data.countrys),v.merchantData.data.agent_id&&(z.value=1),v.merchantData.data.deposit_rate&&(U.value=!0),Q.value={...v.merchantData.data})),w.value=0}));const J=()=>({user_id:null,merchant_type:1,merchant_name:"",countrys:[],agent_user_id:null,agent_rate_in:null,agent_rate_out:null,product_type_id:null,product_name:"",pay_way_id:null,coins_in:[],fee_rate_in:null,coins_out:[],fee_rate_out:null,deposit_rate:null}),K=()=>{Q.value.agent_user_id=null,Q.value.agent_rate_in=null,Q.value.agent_rate_out=null},W=()=>{Q.value.deposit_rate=null},X=e=>{V(e.join(",")).then((e=>{g.value=e.data||[]}))},N=(e,a,l)=>{a?/^[0-9]+(\.[0-9]{1,2})?$/.test(a)?l():l(new Error("请输入数字，最多两位小数")):l(new Error("请输入费率"))},Q=E(),Y=E(),Z=F({user_id:[{required:!0,message:"请选择商户账号",trigger:"blur"}],merchant_name:[{required:!0,message:"请输入商户名称",trigger:"blur"}],agent_rate_in:[{validator:N,trigger:"blur"}],agent_rate_out:[{validator:N,trigger:"blur"}],countrys:[{required:!0,type:"array",message:"请选择国家",trigger:"change"}],pay_way_id:[{required:!0,trigger:"change",message:"请选择支付方式"}],product_type_id:[{required:!0,trigger:"change",message:"请选择产品类型"}],product_name:[{required:!0,message:"请输入产品名称",trigger:"blur"}],coins_in:[{required:!0,type:"array",trigger:"change",message:"请选择代收币种"}],fee_rate_in:[{required:!0,message:"请输入代收费率",trigger:"blur"},{validator:N,trigger:"blur"}],coins_out:[{required:!0,type:"array",trigger:"change",message:"请选择代付币种"}],fee_rate_out:[{required:!0,message:"请输入代付费率",trigger:"blur"},{validator:N,trigger:"blur"}]}),oe=async e=>{e&&await e.validate(((e,a)=>{if(e){if(w.value!==b.length-1)return void w.value++;j(Q.value).then((e=>{1===e.code&&se("录入")}))}}))},se=a=>{e({title:"通知",message:`${a}成功`,type:"success",showClose:!1,duration:3e3}),k.value=!1,f.emit("refreshTable")};return c({dialogFormVisible:k}),(e,m)=>{const c=x,f=a,y=l,V=t,C=u,j=r,E=d,T=o,F=s,H=n,J=i,N=p,se=_;return I(),M("div",null,[A(se,{modelValue:k.value,"onUpdate:modelValue":m[19]||(m[19]=e=>k.value=e),title:""+(v.merchantData?"商户信息修改":"商户信息录入"),class:"sub-dialog",closeOnClickModal:!1,"destroy-on-close":!0},{footer:B((()=>[L("span",de,[w.value!==b.length-1?(I(),O(N,{key:0,type:"primary",onClick:m[17]||(m[17]=e=>oe(Y.value))},{default:B((()=>[P("下一页")])),_:1})):(I(),O(N,{key:1,type:"primary",onClick:m[18]||(m[18]=e=>oe(Y.value))},{default:B((()=>[P("提交审核")])),_:1}))])])),default:B((()=>[A(c,{class:"steps",steps:b,active:w.value,"onUpdate:active":m[0]||(m[0]=e=>w.value=e)},null,8,["active"]),0===w.value?(I(),O(H,{key:0,model:Q.value,ref_key:"ruleFormRef",ref:Y,class:"form-control",rules:Z,"label-position":"top"},{default:B((()=>[A(C,{gutter:18},{default:B((()=>[A(V,{span:12},{default:B((()=>[A(y,{label:"商户类型：",required:""},{default:B((()=>[A(f,{value:"普通商户",disabled:""})])),_:1})])),_:1}),A(V,{span:12},{default:B((()=>[A(y,{label:"商户名称：",prop:"merchant_name",required:""},{default:B((()=>[A(f,{modelValue:Q.value.merchant_name,"onUpdate:modelValue":m[1]||(m[1]=e=>Q.value.merchant_name=e),placeholder:"请输入"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),A(C,{gutter:18},{default:B((()=>[A(V,{span:12},{default:B((()=>[A(y,{label:"商户账号：",prop:"user_id",required:""},{default:B((()=>[A(E,{modelValue:Q.value.user_id,"onUpdate:modelValue":m[2]||(m[2]=e=>Q.value.user_id=e),filterable:"",placeholder:"请选择"},{default:B((()=>[(I(!0),M(R,null,S(q.value,((e,a)=>(I(),O(j,{label:e.username,value:e.id,key:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),A(V,{span:12})])),_:1}),A(C,{gutter:18},{default:B((()=>[A(V,{span:1===z.value?12:24},{default:B((()=>[A(y,{label:"是否有代理商：",required:""},{default:B((()=>[A(F,{modelValue:z.value,"onUpdate:modelValue":m[3]||(m[3]=e=>z.value=e),onChange:K},{default:B((()=>[A(T,{label:1,size:"small"},{default:B((()=>[P("是")])),_:1}),A(T,{label:0,size:"small"},{default:B((()=>[P("否")])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["span"]),1===z.value?(I(),O(V,{key:0,span:12},{default:B((()=>[A(y,{label:"代理商名称：",prop:"agent_user_id"},{default:B((()=>[A(E,{modelValue:Q.value.agent_user_id,"onUpdate:modelValue":m[4]||(m[4]=e=>Q.value.agent_user_id=e),filterable:"",placeholder:"请选择"},{default:B((()=>[(I(!0),M(R,null,S(D.value,((e,a)=>(I(),O(j,{label:e.username,value:e.id,key:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})):$("",!0)])),_:1}),1===z.value?(I(),M("div",ee,[A(C,{gutter:18},{default:B((()=>[A(V,{span:12},{default:B((()=>[A(y,{label:"代收费率：",prop:"agent_rate_in"},{default:B((()=>[A(f,{modelValue:Q.value.agent_rate_in,"onUpdate:modelValue":m[5]||(m[5]=e=>Q.value.agent_rate_in=e),placeholder:"请输入"},{append:B((()=>[P("%")])),_:1},8,["modelValue"])])),_:1})])),_:1}),A(V,{span:12},{default:B((()=>[A(y,{label:"代付费率：",prop:"agent_rate_out"},{default:B((()=>[A(f,{modelValue:Q.value.agent_rate_out,"onUpdate:modelValue":m[6]||(m[6]=e=>Q.value.agent_rate_out=e),placeholder:"请输入"},{append:B((()=>[P("%")])),_:1},8,["modelValue"])])),_:1})])),_:1}),A(V,{span:12})])),_:1})])):$("",!0)])),_:1},8,["model","rules"])):$("",!0),1===w.value?(I(),O(H,{key:1,class:"form-control",ref_key:"ruleFormRef",ref:Y,rules:Z,model:Q.value,"label-position":"top"},{default:B((()=>[A(C,{gutter:18},{default:B((()=>[A(V,{span:12},{default:B((()=>[A(y,{label:"国家/地区：",prop:"countrys",required:""},{default:B((()=>[A(E,{modelValue:Q.value.countrys,"onUpdate:modelValue":m[7]||(m[7]=e=>Q.value.countrys=e),laceholder:"请选择",size:"large",multiple:"",onChange:X},{default:B((()=>[(I(!0),M(R,null,S(G(h).basicData.countryList,((e,a)=>(I(),O(j,{label:e.name,value:e.id,key:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}),A(C,{gutter:18},{default:B((()=>[A(V,{span:12},{default:B((()=>[A(y,{label:"产品类型及名称：",prop:"product_name",required:""},{default:B((()=>[A(f,{modelValue:Q.value.product_name,"onUpdate:modelValue":m[9]||(m[9]=e=>Q.value.product_name=e),placeholder:"请输入",class:"input-with-select",size:"large"},{prepend:B((()=>[A(E,{modelValue:Q.value.product_type_id,"onUpdate:modelValue":m[8]||(m[8]=e=>Q.value.product_type_id=e),placeholder:"请选择",style:{width:"115px"},size:"large"},{default:B((()=>[(I(!0),M(R,null,S(G(h).basicData.options.product_type,((e,a)=>(I(),O(j,{label:e.value,value:e.id,key:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}),A(C,{gutter:18},{default:B((()=>[A(V,{span:12},{default:B((()=>[ae])),_:1})])),_:1}),A(C,{gutter:18},{default:B((()=>[A(V,{span:12},{default:B((()=>[A(y,{label:"费率：",prop:"fee_rate_in",required:""},{default:B((()=>[A(f,{modelValue:Q.value.fee_rate_in,"onUpdate:modelValue":m[10]||(m[10]=e=>Q.value.fee_rate_in=e),placeholder:"请输入"},{append:B((()=>[P("%")])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}),A(C,{gutter:18},{default:B((()=>[A(V,{span:12},{default:B((()=>[A(y,{label:"币种：",prop:"coins_in",required:""},{default:B((()=>[A(E,{modelValue:Q.value.coins_in,"onUpdate:modelValue":m[11]||(m[11]=e=>Q.value.coins_in=e),size:"large",multiple:"",placeholder:"请选择"},{default:B((()=>[(I(!0),M(R,null,S(g.value,((e,a)=>(I(),O(j,{label:e.name,value:e.id,key:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}),A(C,{gutter:18},{default:B((()=>[A(V,{span:12},{default:B((()=>[A(y,{label:"支付方式：",prop:"pay_way_id",required:""},{default:B((()=>[A(E,{modelValue:Q.value.pay_way_id,"onUpdate:modelValue":m[12]||(m[12]=e=>Q.value.pay_way_id=e),size:"large",placeholder:"请选择"},{default:B((()=>[(I(!0),M(R,null,S(G(h).basicData.options.pay_way,((e,a)=>(I(),O(j,{label:e.value,value:e.id,key:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}),A(C,{gutter:18},{default:B((()=>[A(V,{span:12},{default:B((()=>[le])),_:1})])),_:1}),A(C,{gutter:18},{default:B((()=>[A(V,{span:12},{default:B((()=>[A(y,{label:"费率：",prop:"fee_rate_out",required:""},{default:B((()=>[A(f,{modelValue:Q.value.fee_rate_out,"onUpdate:modelValue":m[13]||(m[13]=e=>Q.value.fee_rate_out=e),placeholder:"请输入"},{append:B((()=>[P("%")])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}),A(C,{gutter:18},{default:B((()=>[A(V,{span:12},{default:B((()=>[A(y,{label:"币种：",prop:"coins_out",required:""},{default:B((()=>[A(E,{modelValue:Q.value.coins_out,"onUpdate:modelValue":m[14]||(m[14]=e=>Q.value.coins_out=e),size:"large",multiple:"",placeholder:"请选择"},{default:B((()=>[(I(!0),M(R,null,S(g.value,((e,a)=>(I(),O(j,{label:e.name,value:e.id,key:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}),A(C,{gutter:18},{default:B((()=>[A(V,{span:12},{default:B((()=>[te,A(J,{modelValue:U.value,"onUpdate:modelValue":m[15]||(m[15]=e=>U.value=e),onChange:W},null,8,["modelValue"])])),_:1})])),_:1}),U.value?(I(),O(C,{key:0,gutter:18},{default:B((()=>[A(V,{span:12},{default:B((()=>[A(y,{label:"循环保证金比例：",prop:"deposit_rate"},{default:B((()=>[A(E,{modelValue:Q.value.deposit_rate,"onUpdate:modelValue":m[16]||(m[16]=e=>Q.value.deposit_rate=e),size:"large",placeholder:"请选择"},{default:B((()=>[A(j,{label:"10%",value:10}),A(j,{label:"20%",value:20})])),_:1},8,["modelValue"]),ue])),_:1})])),_:1})])),_:1})):(I(),O(C,{key:1,gutter:18},{default:B((()=>[A(V,{span:12},{default:B((()=>[re])),_:1})])),_:1}))])),_:1},8,["rules","model"])):$("",!0)])),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-450085ae"]]),se={class:"search-data"},ne={class:"search-result"},ie={class:"data-search"},pe=(e=>(J("data-v-7267cb8d"),e=e(),K(),e))((()=>L("span",null,"商户名称：",-1))),_e=w(D({__name:"MerchantListTable",setup(a){const l=E(),t=F({data:{}}),u=H("emitter"),o=F({data:{}}),s=E(),n=E(null);W((()=>{c(),_(),u.on("refreshTable",c)})),X((()=>{u.off("refreshTable")}));const _=()=>{C({text:"",role:1}).then((e=>{l.value=e.data||[]}))},c=(e=1)=>{z({page:e,user_id:n.value||"",check_state:1}).then((e=>{o.data=e.data||[]}))};return(a,u)=>{const _=r,v=d,f=p,g=m,h=i,b=k;return I(),M(R,null,[L("div",se,[L("div",ne,[L("div",ie,[pe,A(v,{modelValue:n.value,"onUpdate:modelValue":u[0]||(u[0]=e=>n.value=e),size:"large",placeholder:"",style:{width:"340px"},clearable:""},{default:B((()=>[(I(!0),M(R,null,S(l.value,((e,a)=>(I(),O(_,{label:e.username,value:e.id,key:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),A(f,{type:"primary",size:"large",class:"search-bth",onClick:u[1]||(u[1]=e=>c(1))},{default:B((()=>[P("查询")])),_:1})])]),A(b,{table:o.data,onCurrentChange:c},{default:B((()=>[A(g,{prop:"merchant_name",label:"商户名称",width:"140"}),A(g,{prop:"merchant_no",label:"商户号",width:"200"}),A(g,{label:"商户状态",width:"120"},{default:B((a=>[A(h,{modelValue:a.row.status,"onUpdate:modelValue":e=>a.row.status=e,"active-value":1,"inactive-value":0,onChange:l=>(({id:a,status:l})=>{U({id:a,key:"status",value:l}).then((a=>{1===a.code&&e({title:"通知",message:"更改状态成功",type:"success",showClose:!1,duration:3e3})}))})(a.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),A(g,{prop:"countrys_text",label:"国家",width:"200"}),A(g,{prop:"agent_user_text",label:"代理商名称",width:"120"}),A(g,{prop:"product_type_id_text",label:"产品类型",width:"120"}),A(g,{prop:"product_name",label:"产品名称",width:"120"}),A(g,{prop:"fee_rate_in",label:"代收费率",width:"120"}),A(g,{prop:"coins_in_text",label:"代收币种",width:"220"}),A(g,{prop:"fee_rate_out",label:"代付费率",width:"120"}),A(g,{prop:"coins_out_text",label:"代付币种",width:"220"}),A(g,{prop:"created",label:"创建时间",width:"200"}),A(g,{prop:"check_time",label:"审核通过时间",width:"200"}),A(g,{prop:"updated",label:"最新修改时间",width:"200"}),A(g,{fixed:"right",label:"操作",width:"120"},{default:B((e=>[A(f,{link:"",type:"primary",size:"small",onClick:a=>{return l=e.row,s.value.dialogFormVisible=!0,void(t.data=l);var l}},{default:B((()=>[P(" 修改 ")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["table"])]),A(oe,{ref_key:"merchantEntryDialog",ref:s,"merchant-data":t},null,8,["merchant-data"])],64)}}}),[["__scopeId","data-v-7267cb8d"]]),me={class:"search-data"},ce={class:"search-result"},ve=(e=>(J("data-v-40fd866e"),e=e(),K(),e))((()=>L("span",null,"批量修改",-1))),fe={style:{"text-align":"right",margin:"0"}},ge=w(D({__name:"MerchantAuditTable",setup(l){const t=F({data:{}}),u=E([]);W((()=>{r()}));const r=(e=1)=>{z({page:e,user_id:"",check_state:""}).then((e=>{t.data=e.data}))},d=e=>{u.value=e},o=(a,l)=>{let t=[];t=l&&l.id?[l.id]:u.value.map((e=>e.id)),l&&l.id&&l.reason&&(l.visible=!1),q({ids:t,state:a,reason:l&&l.reason}).then((a=>{1===a.code&&(r(),e({title:"通知",message:"处理成功",type:"success",showClose:!1,duration:3e3}))}))},s=a=>{u.value.length?-1===a?c.prompt("请输入拒绝理由","批量拒绝",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^\s*\S.*$/,inputErrorMessage:"拒绝理由不能为空",closeOnClickModal:!1}).then((({value:e})=>{o(-1,{reason:e})})).catch((()=>{})):o(1):e({title:"通知",message:"未选择数据",type:"warning",showClose:!1,duration:3e3})};return(e,l)=>{const u=p,n=m,i=v,_=a,c=f,g=k;return I(),M("div",me,[L("div",ce,[ve,A(u,{type:"primary",size:"large",plain:"",class:"control-btn",onClick:l[0]||(l[0]=e=>s(1))},{default:B((()=>[P("通过")])),_:1}),A(u,{type:"primary",size:"large",plain:"",class:"control-btn",onClick:l[1]||(l[1]=e=>s(-1))},{default:B((()=>[P("拒绝")])),_:1})]),A(g,{table:t.data,onCurrentChange:r,onSelection:d},{default:B((()=>[A(n,{type:"selection",width:"55",fixed:"left"}),A(n,{prop:"merchant_name",label:"商户名称",width:"140"}),A(n,{prop:"merchant_no",label:"商户号",width:"200"}),A(n,{prop:"countrys_text",label:"国家",width:"200"}),A(n,{prop:"agent_user_text",label:"代理商名称",width:"120"}),A(n,{prop:"product_type_id_text",label:"产品类型","min-width":"120"}),A(n,{prop:"product_name",label:"产品名称",width:"120"}),A(n,{prop:"product_name",label:"审批状态",width:"120"},{default:B((e=>[A(i,{class:"ml-2",type:G(Y)[e.row.check_state].type},{default:B((()=>[P(N(G(Y)[e.row.check_state].label),1)])),_:2},1032,["type"])])),_:1}),A(n,{fixed:"right",label:"审核",width:"120"},{default:B((e=>[A(u,{link:"",type:"primary",size:"small",onClick:a=>o(1,e.row)},{default:B((()=>[P(" 通过 ")])),_:2},1032,["onClick"]),A(c,{visible:e.row.visible,trigger:"click",placement:"top",width:252},{reference:B((()=>[A(u,{link:"",type:"primary",size:"small",onClick:a=>e.row.visible=!0},{default:B((()=>[P(" 拒绝 ")])),_:2},1032,["onClick"])])),default:B((()=>[L("div",fe,[A(_,{modelValue:e.row.reason,"onUpdate:modelValue":a=>e.row.reason=a,rows:3,type:"textarea",placeholder:"请填写原因",resize:"none",class:"textarea"},null,8,["modelValue","onUpdate:modelValue"]),A(u,{size:"small",onClick:a=>e.row.visible=!1},{default:B((()=>[P("取消")])),_:2},1032,["onClick"]),A(u,{size:"small",type:"primary",onClick:a=>o(-1,e.row)},{default:B((()=>[P("确认")])),_:2},1032,["onClick"])])])),_:2},1032,["visible"])])),_:1})])),_:1},8,["table"])])}}}),[["__scopeId","data-v-40fd866e"]]),he={class:"search-container"},be={class:"header"},ye=w(D({__name:"index",setup(e){const a=E("first"),l=E(),t=E(),u=()=>{l.value.dialogFormVisible=!0,t.value=""};return(e,t)=>{const r=Q("Plus"),d=h,o=p,s=b,n=g;return I(),M("div",he,[A(n,{modelValue:a.value,"onUpdate:modelValue":t[0]||(t[0]=e=>a.value=e),class:"demo-tabs"},{default:B((()=>[A(s,{label:"商户列表",name:"first"},{default:B((()=>[L("div",be,[A(o,{type:"primary",size:"large",onClick:u},{default:B((()=>[A(d,null,{default:B((()=>[A(r)])),_:1}),P(" 商户信息录入 ")])),_:1})]),"first"===a.value?(I(),O(_e,{key:0})):$("",!0)])),_:1}),A(s,{label:"商户审核",name:"second"},{default:B((()=>["second"===a.value?(I(),O(ge,{key:0})):$("",!0)])),_:1})])),_:1},8,["modelValue"]),A(oe,{ref_key:"merchantEntryDialog",ref:l},null,512)])}}}),[["__scopeId","data-v-a6b3ec67"]]);export{ye as default};
