import{E as e,F as a,G as l,i as t,y as d,h as u,A as r,j as i,k as n,d as s,B as o,J as _,e as p}from"./element-plus-1f849017.js";import{m,G as c,n as y,o as v,A as f,E as g,U as h,_ as b,d as V,b as w}from"./index-a68c738b.js";import{d as x,e as j,f as z,J as U,o as k,S as q,R as C,a as $,O as D,V as E,c as T,a8 as F,P,A,i as I,z as G,a0 as J,at as O,au as R,u as S,ag as B}from"./@vue-af2a374f.js";import{s as H}from"./index-6336dc8c.js";import"./lodash-es-968ab13b.js";import"./async-validator-cf877c1f.js";import"./@vueuse-be664744.js";import"./dayjs-3df08a9b.js";import"./clipboard-690b0fc8.js";import"./@element-plus-ce49c33a.js";import"./@ctrl-91de2ec7.js";import"./@popperjs-b78c3215.js";import"./escape-html-3c2115ff.js";import"./normalize-wheel-es-3222b0a2.js";import"./vue-router-0700730f.js";import"./axios-fb7d3bb8.js";import"./pinia-a9355e46.js";import"./pinia-plugin-persistedstate-d2bd58cf.js";import"./zipson-d6101bf1.js";import"./mitt-f0e54764.js";async function M(e){const a=void 0!==e?"?fee_rate_in="+e:"";return(await m.get(y+a)).data}const K={class:"dialog-footer"},L=b(x({__name:"AddPayeeDialog",props:["payeeEntryData"],setup(o,{expose:_}){const p=o,c=A("emitter"),y=j(!1),h=j(),b=j(),V=j();z(y,((e,a)=>{if(e&&(V.value={merchant_id:"",sys_channel_id:"",pay_product:"",single_day_limit_money:"",single_limit_money:"",weigh:"",status:0},x(),p.payeeEntryData)){const{fee_rate_in:e}=p.payeeEntryData.data;e&&w(e),V.value={...p.payeeEntryData.data}}}));const w=e=>{M(e).then((e=>{b.value=e.data||[]}))},x=()=>{(async function(){return(await m.get(`${v}`)).data})().then((e=>{h.value=e.data||[]}))},I=e=>{const{product_type_id_text:a,product_name:l,coins_in_text:t,pay_way_id_text:d,fee_rate_in:u}=h.value.find((a=>a.id===e));V.value={...V.value,product_type_id_text:a,product_name:l,coins_in_text:t,pay_way_id_text:d,fee_rate_in:u},V.value.pay_rate="",V.value.sys_channel_id="",u&&w(u)},G=e=>{const{pay_rate:a}=b.value.find((a=>a.id===e));V.value.pay_rate=a},J=(e,a,l)=>{/^[0-9]+(\.[0-9]{1,2})?$/.test(a)?l():l(new Error("请输入数字，最多两位小数"))},O=U({merchant_id:[{required:!0,message:"请选择商户",trigger:"change"}],pay_product:[{required:!0,message:"请选择支付产品",trigger:"change"}],sys_channel_id:[{required:!0,message:"请选择通道",trigger:"change"}],single_day_limit_money:[{required:!0,message:"请输入商户单日配额",trigger:"blur"},{validator:J,trigger:"blur"}],single_limit_money:[{required:!0,message:"请输入商户单笔限额",trigger:"blur"},{validator:J,trigger:"blur"}],weigh:[{required:!0,message:"请输入轮询权重",trigger:"blur"},{validator:J,trigger:"blur"}]}),R=j(),S=async e=>{e&&await e.validate(((e,a)=>{e&&(p.payeeEntryData?async function(e){return(await m.post(`${g}`,e)).data}(V.value).then((e=>{1===e.code&&B("修改")})):async function(e){return(await m.post(`${f}`,e)).data}(V.value).then((e=>{1===e.code&&B("新增")})))}))},B=a=>{e({title:"通知",message:`${a}成功`,type:"success",showClose:!1,duration:3e3}),y.value=!1,c.emit("refreshTable")};return _({dialogFormVisible:y}),(e,o)=>{const _=a,m=l,c=t,v=d,f=u,g=r,w=i,x=n,j=s;return k(),q(j,{modelValue:y.value,"onUpdate:modelValue":o[14]||(o[14]=e=>y.value=e),title:""+(p.payeeEntryData?"修改商户配通道信息":"新增商户配通道信息"),class:"sub-dialog",closeOnClickModal:!1,width:"756px","destroy-on-close":!0},{footer:C((()=>[$("span",K,[D(x,{onClick:o[12]||(o[12]=e=>y.value=!1),size:"large"},{default:C((()=>[E("取消")])),_:1}),D(x,{type:"primary",onClick:o[13]||(o[13]=e=>S(R.value)),size:"large"},{default:C((()=>[E("保存")])),_:1})])])),default:C((()=>[D(w,{model:V.value,ref_key:"ruleFormRef",ref:R,rules:O,"label-position":"top"},{default:C((()=>[D(g,{gutter:18},{default:C((()=>[D(v,{span:12},{default:C((()=>[D(c,{label:"商户名称：",prop:"merchant_id",required:""},{default:C((()=>[D(m,{modelValue:V.value.merchant_id,"onUpdate:modelValue":o[0]||(o[0]=e=>V.value.merchant_id=e),size:"large",placeholder:"请选择",filterable:"",onChange:I},{default:C((()=>[(k(!0),T(P,null,F(h.value,((e,a)=>(k(),q(_,{label:e.merchant_name,value:e.id,key:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),D(v,{span:12},{default:C((()=>[D(c,{label:"支付方式："},{default:C((()=>[D(f,{size:"large",modelValue:V.value.pay_way_id_text,"onUpdate:modelValue":o[1]||(o[1]=e=>V.value.pay_way_id_text=e),disabled:""},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),D(g,{gutter:18},{default:C((()=>[D(v,{span:12},{default:C((()=>[D(c,{label:"产品类型："},{default:C((()=>[D(f,{modelValue:V.value.product_type_id_text,"onUpdate:modelValue":o[2]||(o[2]=e=>V.value.product_type_id_text=e),size:"large",disabled:""},null,8,["modelValue"])])),_:1})])),_:1}),D(v,{span:12},{default:C((()=>[D(c,{label:"产品名称："},{default:C((()=>[D(f,{size:"large",modelValue:V.value.product_name,"onUpdate:modelValue":o[3]||(o[3]=e=>V.value.product_name=e),disabled:""},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),D(g,{gutter:18},{default:C((()=>[D(v,{span:12},{default:C((()=>[D(c,{label:"币种："},{default:C((()=>[D(f,{modelValue:V.value.coins_in_text,"onUpdate:modelValue":o[4]||(o[4]=e=>V.value.coins_in_text=e),size:"large",disabled:""},null,8,["modelValue"])])),_:1})])),_:1}),D(v,{span:12},{default:C((()=>[D(c,{label:"商户费率："},{default:C((()=>[D(f,{size:"large",modelValue:V.value.fee_rate_in,"onUpdate:modelValue":o[5]||(o[5]=e=>V.value.fee_rate_in=e),disabled:""},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),D(g,{gutter:18},{default:C((()=>[D(v,{span:12},{default:C((()=>[D(c,{label:"通道名称：",prop:"sys_channel_id",required:""},{default:C((()=>[D(m,{modelValue:V.value.sys_channel_id,"onUpdate:modelValue":o[6]||(o[6]=e=>V.value.sys_channel_id=e),size:"large",placeholder:"请选择",onChange:G},{default:C((()=>[(k(!0),T(P,null,F(b.value,((e,a)=>(k(),q(_,{label:e.channel_name,value:e.id,key:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),D(v,{span:12},{default:C((()=>[D(c,{label:"通道费率："},{default:C((()=>[D(f,{size:"large",modelValue:V.value.pay_rate,"onUpdate:modelValue":o[7]||(o[7]=e=>V.value.pay_rate=e),disabled:""},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),D(g,{gutter:18},{default:C((()=>[D(v,{span:12},{default:C((()=>[D(c,{label:"商户单日配额：",prop:"single_day_limit_money",required:""},{default:C((()=>[D(f,{modelValue:V.value.single_day_limit_money,"onUpdate:modelValue":o[8]||(o[8]=e=>V.value.single_day_limit_money=e),size:"large",placeholder:"请输入"},null,8,["modelValue"])])),_:1})])),_:1}),D(v,{span:12},{default:C((()=>[D(c,{label:"商户单笔限额：",prop:"single_limit_money",required:""},{default:C((()=>[D(f,{size:"large",modelValue:V.value.single_limit_money,"onUpdate:modelValue":o[9]||(o[9]=e=>V.value.single_limit_money=e),placeholder:"请输入"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),D(g,{gutter:18},{default:C((()=>[D(v,{span:12},{default:C((()=>[D(c,{label:"轮询权重：",prop:"weigh",required:""},{default:C((()=>[D(f,{size:"large",modelValue:V.value.weigh,"onUpdate:modelValue":o[10]||(o[10]=e=>V.value.weigh=e),placeholder:"请输入"},null,8,["modelValue"])])),_:1})])),_:1}),D(v,{span:12},{default:C((()=>[D(c,{label:"支付产品：",prop:"pay_product",required:""},{default:C((()=>[D(m,{modelValue:V.value.pay_product,"onUpdate:modelValue":o[11]||(o[11]=e=>V.value.pay_product=e),size:"large",placeholder:"请选择"},{default:C((()=>[D(_,{label:"代收",value:0}),D(_,{label:"代付",value:1})])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])}}}),[["__scopeId","data-v-4d2c1f55"]]),N={class:"search-data"},Q=(e=>(O("data-v-315fc74a"),e=e(),R(),e))((()=>$("div",{class:"search-result"},"支付通道",-1))),W=b(x({__name:"PayeeEntryTable",setup(a){const l=A("emitter"),t=U({data:{}}),d=U({data:{}}),u=j(),r=j(""),i=j(""),s=j(""),p=j("");I((()=>{v(),l.on("refreshTable",v),l.on("inquireTable",y)})),G((()=>{l.off("refreshTable"),l.off("inquireTable",y)}));const y=({merchant_id:e,product_type_id:a,product_name:l,sys_channel_id:t})=>{r.value=e,i.value=a,s.value=l,p.value=t,v()},v=(e=1)=>{(async function({page:e,merchant_id:a,sys_channel_id:l,product_type_id:t,product_name:d}){return(await m.get(`${c}?rows=10&page=${e}&merchant_id=${a}&sys_channel_id=${l}&product_type_id=${t}&product_name=${d}`)).data})({page:e,merchant_id:r.value,sys_channel_id:p.value,product_type_id:i.value,product_name:s.value}).then((e=>{t.data=e.data||[]}))},f=({id:a,status:l})=>{(async function({id:e,status:a}){return(await m.post(`${h}`,{id:e,status:a})).data})({id:a,status:l}).then((a=>{1===a.code&&e({title:"通知",message:"更改状态成功",type:"success",showClose:!1,duration:3e3})}))};return(e,a)=>{const l=o,r=_,i=n,s=V;return k(),T(P,null,[$("div",N,[Q,D(s,{table:t.data,onCurrentChange:v},{default:C((()=>[D(l,{label:"序号",width:"80",type:"index",index:e=>e+1},null,8,["index"]),D(l,{prop:"merchant_name",label:"商户名称",width:"120"}),D(l,{prop:"channel_name",label:"通道名称",width:"160"}),D(l,{prop:"channel_num",label:"通道编号",width:"160"}),D(l,{prop:"status",label:"通道开关",width:"120"},{default:C((e=>[D(r,{modelValue:e.row.status,"onUpdate:modelValue":a=>e.row.status=a,"active-value":1,"inactive-value":0,onChange:a=>f(e.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),D(l,{prop:"product_name",label:"产品名称",width:"180"}),D(l,{prop:"product_type_id_text",label:"产品类型",width:"160"}),D(l,{prop:"pay_success_rate",label:"支付成功率",width:"120"}),D(l,{prop:"fee_rate_in",label:"商户支付费率",width:"200"}),D(l,{prop:"coins_in_text",label:"币种",width:"200"}),D(l,{prop:"single_day_limit_money",label:"商户单日配额",width:"200"}),D(l,{prop:"single_limit_money",label:"商户单笔限额",width:"200"}),D(l,{prop:"weigh",label:"轮询权重",width:"120"}),D(l,{prop:"pay_way_id_text",label:"支付方式",width:"200"}),D(l,{prop:"created",label:"创建时间",width:"200"}),D(l,{prop:"updated",label:"最新修改时间",width:"200"}),D(l,{fixed:"right",label:"操作",width:"120"},{default:C((e=>[D(i,{link:"",type:"primary",size:"small",onClick:J((a=>{return l=e.row,u.value.dialogFormVisible=!0,void(d.data=l);var l}),["prevent"])},{default:C((()=>[E(" 修改 ")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["table"])]),D(L,{ref_key:"addPayeeDialog",ref:u,"payee-entry-data":d},null,8,["payee-entry-data"])],64)}}}),[["__scopeId","data-v-315fc74a"]]),X={class:"search-form"},Y=b(x({__name:"SearchForm",setup(e){const s=j(),o=A("emitter"),_=j(),p=w(),m=j({merchant_id:"",product_type_id:"",product_name:"",sys_channel_id:""});I((()=>{y(),c()}));const c=()=>{M().then((e=>{s.value=e.data||[]}))},y=()=>{H({text:"",role:1}).then((e=>{_.value=e.data||[]}))},v=()=>{o.emit("inquireTable",m.value)};return(e,o)=>{const c=a,y=l,f=t,g=d,h=u,b=r,V=n,w=i;return k(),T("div",X,[D(w,{model:m.value,"label-position":"top"},{default:C((()=>[D(b,{gutter:36},{default:C((()=>[D(g,{span:8},{default:C((()=>[D(f,{label:"商户名称："},{default:C((()=>[D(y,{modelValue:m.value.merchant_id,"onUpdate:modelValue":o[0]||(o[0]=e=>m.value.merchant_id=e),size:"large",placeholder:"请选择",filterable:"",clearable:""},{default:C((()=>[(k(!0),T(P,null,F(_.value,((e,a)=>(k(),q(c,{label:e.username,value:e.id,key:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),D(g,{span:8},{default:C((()=>[D(f,{label:"产品类型："},{default:C((()=>[D(y,{modelValue:m.value.product_type_id,"onUpdate:modelValue":o[1]||(o[1]=e=>m.value.product_type_id=e),placeholder:"请选择",size:"large",clearable:""},{default:C((()=>[(k(!0),T(P,null,F(S(p).basicData.options.product_type,((e,a)=>(k(),q(c,{label:e.value,value:e.id,key:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),D(g,{span:8},{default:C((()=>[D(f,{label:"产品名称："},{default:C((()=>[D(h,{modelValue:m.value.product_name,"onUpdate:modelValue":o[2]||(o[2]=e=>m.value.product_name=e),size:"large",placeholder:"请输入"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),D(b,{gutter:36},{default:C((()=>[D(g,{span:8},{default:C((()=>[D(f,{label:"通道名称："},{default:C((()=>[D(y,{modelValue:m.value.sys_channel_id,"onUpdate:modelValue":o[3]||(o[3]=e=>m.value.sys_channel_id=e),size:"large",placeholder:"请选择",filterable:"",clearable:""},{default:C((()=>[(k(!0),T(P,null,F(s.value,((e,a)=>(k(),q(c,{label:e.channel_name,value:e.id,key:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),D(g,{span:8,class:"submit-btn"},{default:C((()=>[D(f,null,{default:C((()=>[D(V,{size:"large",type:"primary",onClick:v},{default:C((()=>[E("查询")])),_:1})])),_:1})])),_:1}),D(g,{span:8})])),_:1})])),_:1},8,["model"])])}}}),[["__scopeId","data-v-0a5385b2"]]),Z={class:"search-container"},ee={class:"header"},ae=b(x({__name:"index",setup(e){const a=j();return(e,l)=>{const t=B("Plus"),d=p,u=n;return k(),T(P,null,[$("div",Z,[$("div",ee,[D(u,{type:"primary",size:"large",onClick:l[0]||(l[0]=e=>a.value.dialogFormVisible=!0)},{default:C((()=>[D(d,null,{default:C((()=>[D(t)])),_:1}),E(" 添加 ")])),_:1})]),D(Y),D(W)]),D(L,{ref_key:"addPayeeDialog",ref:a},null,512)],64)}}}),[["__scopeId","data-v-52c23b6c"]]);export{ae as default};
